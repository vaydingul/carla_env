experiment_type: test_mpc
log_path: ~
seed: 42
port: &port_var 2000
tm_port: &tm_port_var 8000
num_time_step_previous: &previous 20
num_time_step_future: &future 10

cost:
  type: "extended_bev"
  config:
    image_width: 192
    image_height: 192
    reduction: "sum"
    mask_alpha: 1.1
    decay_factor: 0.99
    vehicle_width: 2.1
    vehicle_length: 4.9
    pixels_per_meter: 5
    longitudinal_offset: 0.125
    longitudinal_scaler: 1
    longitudinal_speed_offset: 0.125
    longitudinal_speed_scaler: 2.0
    lateral_offset: 1.0
    lateral_scaler: 0.5

environment:
  name: carla_env_testing_traffic
  random: false
  action_repeat: 1
  fixed_delta_seconds: &dt 0.05
  max_steps: 5000
  port: *port_var
  tm_port: *tm_port_var
  tasks:
    - world: Town02
      num_vehicles: [60, 90]
    # - world: Town03
    #   num_vehicles: [60, 90]
    # - world: Town04
    #   num_vehicles: [120, 180]
    # - world: Town06
    #   num_vehicles: [150, 300]

  renderer:
    width: 2800
    height: 900
    channel: 3
    background_color: [0, 0, 0]
    font_scale: 0.3
    font_color: [255, 255, 255]
    font_thickness: 1
    cursor: [0, 0]
    name: MPC Testing
    show: true
    save: false
    create_date_time_path: true
    save_path: figures/env_debug/test_mpc/

  sensors:
    - id: rgb_front
      type: RGBSensor
      config:
        x: 1.5
        y: 0.0
        z: 2.4
        roll: 0.0
        pitch: 0.0
        yaw: 0.0
        width: 900
        height: 256
        fov: 100

    - id: ego
      type: VehicleSensor
      config: {}

    # - id: occ
    #   type: OccupancySensor
    #   config:
    #     threshold: 3
    #     number_of_radars: 8
    #     horizontal_fov: 5
    #     vertical_fov: 5
    #     range: 10
    #     points_per_second: 100

    #! It is a must. NEVER DISCARD IT.
    - id: col
      type: CollisionSensor
      config: {}

  bevs:
    - id: "bev_world"
      config:
        width: 192
        height: 192
        render_lanes_on_junctions: false
        pixels_per_meter: 5
        crop_type: "FRONT_AREA_ONLY"
        road_on_off: true
        road_light: true
        light_circle: true
        lane_marking_thickness: 2

  route:
    config:
      sampling_resolution: 0.5
      debug: true

tester:
  batch_size: 1
  action_size: 2
  num_optimization_iteration: 40
  init_action: "zeros"
  skip_frames: 1
  repeat_frames: 1
  rollout_length: *future
  log_video: true
  log_video_scale: 0.1
  bev_agent_channel: 7
  bev_vehicle_channel: 6
  bev_selected_channels: [0, 1, 2, 3, 4, 5, 6, 11]
  bev_calculate_offroad: false

  cost_weight:
    road_cost: 0.0
    road_on_cost: 0.0
    road_off_cost: 0.0
    road_red_yellow_cost: 0.0
    road_green_cost: -0.0
    vehicle_cost: 0.0
    lane_cost: 0.0
    offroad_cost: 0.0
    acceleration_jerk: 1.0
    steer_jerk: 10.0
    ego_location_l1: 100.0
    ego_yaw_l1: 10.0
    ego_speed_l1: 100.0

# MPC is a kind of RL training.
training:
  gradient_clip:
    enable: true
    type: "norm"
    value: 1

  optimizer:
    type: "Adam"
    config:
      lr: 0.05
      # weight_decay: 0.0001

wandb_ego_forward_model:
  link: vaydingul/mbl-refactored/16ruxyiq
  checkpoint_number: 99

# It can be None.
# In this case, last BEV tensor should be copied
# num_time_step_previous times.
wandb_world_forward_model:
  ~
  # link: ""
  # checkpoint_number: 0

wandb:
  enable: false
  resume: false
  resume_checkpoint_number: 0
  project: "mbl-refactored"
  group: "test-mpc-20Hz"
  name: "20-10-20Hz"
  id: ~
  notes: ""
